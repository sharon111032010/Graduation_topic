<!--  -->
<header>
    <h1>AI 校園助手</h1>
    <p>讓校園生活更輕鬆</p>
</header>

<main>
    <section class="left-column">
        <h2>加入我們的校園社群</h2>
        <p>創建您的帳號，享受個人化的校園服務體驗。我們將為您提供最相關的資訊和協助。</p>
        <p>註冊過程簡單快速，只需要幾個步驟就能開始使用所有功能。</p>

        <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="progressPercent"></div>
        </div>
        <p class="progress-text">註冊進度：{{ progressText }}</p>
    </section>

    <section class="right-column">
        <form [formGroup]="registrationForm" (ngSubmit)="nextStep()">
            <div class="step-container">

                <!-- 步驟 1: 基本資料 -->
                <div class="step" [class.active]="currentStep === 1" *ngIf="currentStep === 1">
                    <h2>基本資料</h2>
                    <div class="step-indicator">第 1 步，共 3 步</div>

                    <label for="email">電子郵件</label>
                    <input type="email" id="email" formControlName="email" placeholder="請輸入您的電子郵件"
                        [class.valid]="registrationForm.get('email')?.valid && registrationForm.get('email')?.touched"
                        [class.invalid]="hasError('email')" />
                    <div class="error-message" [class.show]="hasError('email')">
                        {{ getErrorMessage('email') }}
                    </div>

                    <div class="field-group">
                        <div>
                            <label for="firstName">姓名</label>
                            <input type="text" id="firstName" formControlName="firstName" placeholder="姓氏"
                                [class.valid]="registrationForm.get('firstName')?.valid && registrationForm.get('firstName')?.touched"
                                [class.invalid]="hasError('firstName')" />
                        </div>
                        <!-- <div>
                            <label for="lastName">名字</label>
                            <input type="text" id="lastName" formControlName="lastName" placeholder="名字"
                                [class.valid]="registrationForm.get('lastName')?.valid && registrationForm.get('lastName')?.touched"
                                [class.invalid]="hasError('lastName')" />
                        </div> -->
                    </div>

                    <label for="studentId">學號</label>
                    <input type="text" id="studentId" formControlName="studentId" placeholder="請輸入您的學號"
                        [class.valid]="registrationForm.get('studentId')?.valid && registrationForm.get('studentId')?.touched"
                        [class.invalid]="hasError('studentId')" />
                    <div class="error-message" [class.show]="hasError('studentId')">
                        {{ getErrorMessage('studentId') }}
                    </div>

                    <button type="button" (click)="nextStep()">下一步</button>
                </div>

                <!-- 步驟 2: 密碼設定 -->
                <div class="step" [class.active]="currentStep === 2" *ngIf="currentStep === 2">
                    <h2>密碼設定</h2>
                    <div class="step-indicator">第 2 步，共 3 步</div>

                    <label for="password">設定密碼</label>
                    <input type="password" id="password" formControlName="password" placeholder="請設定您的密碼"
                        [class.valid]="registrationForm.get('password')?.valid && registrationForm.get('password')?.touched"
                        [class.invalid]="hasError('password')" />
                    <div class="strength-meter">
                        <div class="strength-fill" [ngClass]="passwordStrength.class"></div>
                    </div>
                    <div class="password-strength-text">
                        密碼強度：{{ passwordStrength.label }}
                    </div>

                    <label for="confirmPassword">確認密碼</label>
                    <input type="password" id="confirmPassword" formControlName="confirmPassword" placeholder="請再次輸入密碼"
                        [class.valid]="!registrationForm.hasError('passwordMismatch') && registrationForm.get('confirmPassword')?.touched && registrationForm.get('confirmPassword')?.value"
                        [class.invalid]="registrationForm.hasError('passwordMismatch') && registrationForm.get('confirmPassword')?.touched" />
                    <div class="error-message"
                        [class.show]="registrationForm.hasError('passwordMismatch') && registrationForm.get('confirmPassword')?.touched">
                        {{ getPasswordConfirmError() }}
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn-secondary" (click)="prevStep()">上一步</button>
                        <button type="button" (click)="nextStep()">下一步</button>
                    </div>
                </div>

                <!-- 步驟 3: 個人資訊 -->
                <div class="step" [class.active]="currentStep === 3" *ngIf="currentStep === 3">
                    <h2>個人資訊</h2>
                    <div class="step-indicator">第 3 步，共 3 步</div>

                    <label for="department">系所</label>
                    <select id="department" formControlName="department"
                        [class.valid]="registrationForm.get('department')?.valid && registrationForm.get('department')?.touched"
                        [class.invalid]="hasError('department')">
                        <option value="">請選擇您的系所</option>
                        <option *ngFor="let dept of departments" [value]="dept.value">
                            {{ dept.label }}
                        </option>
                    </select>

                    <label for="grade">年級</label>
                    <select id="grade" formControlName="grade"
                        [class.valid]="registrationForm.get('grade')?.valid && registrationForm.get('grade')?.touched"
                        [class.invalid]="hasError('grade')">
                        <option value="">請選擇年級</option>
                        <option *ngFor="let grade of grades" [value]="grade.value">
                            {{ grade.label }}
                        </option>
                    </select>

                    <label for="account">帳號</label>
                    <input type="text" id="account" formControlName="account" placeholder="請輸入帳號" />

                    <div class="button-group">
                        <button type="button" class="btn-secondary" (click)="prevStep()">上一步</button>
                        <button type="button" (click)="nextStep()">完成註冊</button>
                    </div>
                </div>

                <!-- 成功頁面 -->
                <div class="step" [class.active]="currentStep === 4" *ngIf="currentStep === 4">
                    <div class="success-animation">
                        <div class="checkmark"></div>
                        <h2>註冊成功！</h2>
                        <p class="success-message">
                            歡迎加入 AI 校園助手！<br>
                            您的帳號已成功創建，現在可以開始使用所有功能。
                        </p>
                        <button type="button" (click)="goToLogin()">前往登入</button>
                    </div>
                </div>
                <!-- 失敗頁面 -->
                <div  [class.active]="currentStep === 5" *ngIf="currentStep === 5" class="error-step">
                    <div class="success-animation">
                        <!-- <span class="material-symbols-outlined">close</span> -->
                        <h2>註冊失敗！</h2>
                        <p class="success-message">
                            很抱歉，註冊過程中發生了錯誤。<br>
                            <!-- 您的帳號已成功創建，現在可以開始使用所有功能。 -->
                        </p>
                        <!-- <button type="button" (click)="goToLogin()">重新註冊</button> -->
                        <button (click)="currentStep = 1">重新輸入</button>
                    </div>
                </div>

            </div>
        </form>

        <div class="login-link">
            已經有帳號了嗎？<a href="/loginPage" (click)="goToLogin()">立即登入</a>
        </div>
    </section>
</main>