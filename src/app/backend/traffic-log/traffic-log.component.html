<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="logo">AI æ ¡åœ’åŠ©æ‰‹ - ç®¡ç†å¾Œå°</div>
        <div class="admin-info">
            <span>ç®¡ç†å“¡ï¼š{{ adminInfo.name }}</span>
            <button class="logout-btn" (click)="logout()">ç™»å‡º</button>
        </div>
    </div>
</header>

<!-- Main Container -->
<div class="container">
    <!-- Statistics Overview -->
    <div class="stat-grid">
        <div class="stat-card" *ngFor="let stat of statisticsCards">
            <div class="stat-number">{{ stat.number }}</div>
            <div class="stat-label">{{ stat.label }}</div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard-grid">
        <!-- æµé‡ç´€éŒ„å„€è¡¨æ¿ -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-title">æµé‡ç´€éŒ„å„€è¡¨æ¿</div>
            </div>

            <div class="tabs">
                <button class="tab" [class.active]="activeTrafficTab === 'traffic-daily'"
                    (click)="showTrafficTab('traffic-daily')">
                    æ¯æ—¥ä½¿ç”¨
                </button>
                <button class="tab" [class.active]="activeTrafficTab === 'traffic-hourly'"
                    (click)="showTrafficTab('traffic-hourly')">
                    ç†±é–€æ™‚æ®µ
                </button>
            </div>

            <div class="tab-content" [class.active]="activeTrafficTab === 'traffic-daily'">
                <div class="chart-container">
                    <div>ğŸ“ˆ æ¯æ—¥ä½¿ç”¨æ¬¡æ•¸åœ–è¡¨ (å¾…ä¸²æ¥åœ–è¡¨åº«)</div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>æœ¬é€±æ•¸æ“šï¼š</strong>
                    <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                        <li *ngFor="let data of weeklyData">
                            {{ data.day }}ï¼š{{ data.count.toLocaleString() }} æ¬¡
                            <span *ngIf="data.isToday"> (ä»Šæ—¥)</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="tab-content" [class.active]="activeTrafficTab === 'traffic-hourly'">
                <div class="chart-container">
                    <div>â° ç†±é–€æ™‚é–“å€æ®µåœ–è¡¨ (å¾…ä¸²æ¥åœ–è¡¨åº«)</div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>ç†±é–€æ™‚æ®µæ’åï¼š</strong>
                    <ol style="margin-top: 0.5rem; padding-left: 1.5rem;">
                        <li *ngFor="let hour of popularHours">
                            {{ hour.time }} ({{ hour.count }} æ¬¡)
                        </li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- å•é¡Œåˆ†é¡è¦åŠƒ -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">ğŸ“</div>
                <div class="card-title">å•é¡Œåˆ†é¡è¦åŠƒ</div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>åˆ†é¡åç¨±</th>
                            <th>å•é¡Œæ•¸é‡</th>
                            <th>ä½¿ç”¨é »ç‡</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let category of categories">
                            <td>{{ category.name }}</td>
                            <td>{{ category.questionCount }}</td>
                            <td>
                                <div class="progress-bar">
                                    <div class="progress-fill" [style.width.%]="category.usage"></div>
                                </div>
                                {{ category.usage }}%
                            </td>
                            <td>
                                <button class="btn btn-secondary" (click)="editCategory(category)">
                                    ç·¨è¼¯
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <button class="btn btn-primary" style="margin-top: 1rem;" (click)="addCategory()">
                æ–°å¢åˆ†é¡
            </button>
        </div>

        <!-- å›ç­”æˆåŠŸç‡è¿½è¹¤ -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">âœ…</div>
                <div class="card-title">å›ç­”æˆåŠŸç‡è¿½è¹¤</div>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <span><strong>æ•´é«”æˆåŠŸç‡</strong></span>
                    <span style="font-size: 1.5rem; font-weight: bold; color: #2e7d32;">
                        {{ overallSuccessRate }}%
                    </span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="overallSuccessRate"></div>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å•é¡Œé¡å‹</th>
                            <th>æˆåŠŸç‡</th>
                            <th>ç”¨æˆ¶å›é¥‹</th>
                            <th>ç‹€æ…‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of successRateData">
                            <td>{{ data.type }}</td>
                            <td>{{ data.rate }}%</td>
                            <td>ğŸ‘ {{ data.likes }} / ğŸ‘ {{ data.dislikes }}</td>
                            <td>
                                <span class="status-badge" [ngClass]="getStatusClass(data.status)">
                                    {{ data.statusText }}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æœªå‘½ä¸­å•é¡Œæ”¶é›† -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">â“</div>
                <div class="card-title">æœªå‘½ä¸­å•é¡Œæ”¶é›†</div>
            </div>

            <div style="margin-bottom: 1rem;">
                <button class="btn btn-primary" (click)="exportList()">åŒ¯å‡ºæ¸…å–®</button>
                <button class="btn btn-secondary" style="margin-left: 0.5rem;" (click)="batchProcess()">
                    æ‰¹æ¬¡è™•ç†
                </button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å•é¡Œå…§å®¹</th>
                            <th>æå•æ™‚é–“</th>
                            <th>æå•æ¬¡æ•¸</th>
                            <th>è™•ç†ç‹€æ…‹</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let question of unhandledQuestions">
                            <td>{{ question.question }}</td>
                            <td>{{ question.time }}</td>
                            <td>{{ question.count }}</td>
                            <td>
                                <span class="status-badge" [ngClass]="getStatusClass(question.status)">
                                    {{ question.statusText }}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-secondary" *ngIf="question.status === 'pending'"
                                    (click)="addToFAQ(question)">
                                    åŠ å…¥FAQ
                                </button>
                                <button class="btn btn-secondary" *ngIf="question.status === 'processed'"
                                    (click)="viewQuestion(question)">
                                    æª¢è¦–
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- è¨ªå®¢ä½¿ç”¨çµ±è¨ˆ -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">ğŸ‘¥</div>
                <div class="card-title">è¨ªå®¢ä½¿ç”¨çµ±è¨ˆ</div>
            </div>

            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                <div style="text-align: center; padding: 1rem; background: #f8fbff; border-radius: 8px;">
                    <div style="font-size: 2rem; font-weight: bold; color: #006699;">
                        {{ loginUserPercentage }}%
                    </div>
                    <div style="color: #666;">ç™»å…¥ç”¨æˆ¶</div>
                </div>
                <div style="text-align: center; padding: 1rem; background: #f8fbff; border-radius: 8px;">
                    <div style="font-size: 2rem; font-weight: bold; color: #006699;">
                        {{ guestUserPercentage }}%
                    </div>
                    <div style="color: #666;">è¨ªå®¢ç”¨æˆ¶</div>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ç”¨æˆ¶èº«ä»½</th>
                            <th>ä½¿ç”¨æ¬¡æ•¸</th>
                            <th>ä½”æ¯”</th>
                            <th>å¹³å‡æœƒè©±æ™‚é•·</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let user of userStatistics">
                            <td>{{ user.icon }} {{ user.type }}</td>
                            <td>{{ user.usage.toLocaleString() }}</td>
                            <td>{{ user.percentage }}%</td>
                            <td>{{ user.avgDuration }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>